<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filler Spiel</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }

        table {
            width: 90%;
            margin: 20px auto;
            border-collapse: collapse;
        }

        td {
            width: 30%;
            text-align: center;
        }

        button {
            width: 80%;
            padding: 10px;
            margin: 10px;
            font-size: 16px;
            background-color: lightgray;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }

        button:hover {
            background-color: gray;
            color: white;
        }

        #modeSelection {
            margin: 20px auto;
        }

        #overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 9;
        }

        #resultModal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border: 2px solid black;
            z-index: 10;
        }

        .level {
            display: inline-block;
            width: 25%; /* 25% der Breite */
            height: 70px; /* Höhe der Buttons */
            margin: 2.5%; /* 5% Abstand insgesamt (2.5% auf jeder Seite) */
            border: 2px solid black;
            border-radius: 10px; /* Abgerundete Ecken */
            cursor: pointer;
            line-height: 70px; /* Vertikale Zentrierung des Textes */
            font-size: 18px; /* Kleinere Schriftgröße */
            background-color: lightgray;
        }

        /* Style for profile buttons */
        .profileButton {
            width: 45%;
            padding: 10px;
            font-size: 16px;
            background-color: salmon;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            display: inline-block;
            margin: 0 5%;
        }
        .profileButton:hover {
            background-color: tomato;
            color: white;
        }
        
    </style>
</head>
<body>
    <h1>Filler Spiel</h1>
    <p>Ziel ist es, das Spielfeld komplett in einer Farbe zu füllen. Du beginnst in der Mitte und wählst bei jedem Zug eine Farbe. Jede angrenzende Fläche in deiner gewählten Farbe wird dann deinem Bereich hinzugefügt. Das Ziel ist, möglichst viele Felder in wenigen Zügen einzunehmen. Achte darauf, strategisch vorzugehen, da du nur eine begrenzte Anzahl an Zügen hast. Gewinne, indem du das gesamte Spielfeld in deiner Farbe füllst.</p></p>

    <!-- Modus-Auswahl -->
    <div id="modeSelection">
        <h2>Wähle deinen Modus:</h2>
        <button onclick="showProfile()">Profil</button>
        <button onclick="showSinglePlayer()">Einzelspieler</button>
        <button onclick="showMultiPlayer()">Mehrspieler</button>
        <button onclick="showChallenges()">Herausforderungen [ALPHA]</button>
    </div>

    <!-- Profil-Ansicht -->
    <div id="profile" style="display: none;">
    <img id="challengeBanner" src="herausforderung_spiel_index_banner.png.PNG" alt="Herausforderungen Banner" style="width: 90%;">
    <p>Profil für <span id="username" style="font-weight: bold;"></span></p>
    <p>EXP: <span id="userExp"></span></p>

    <!-- Musik Dropdown mit größerem Styling -->
    <div style="margin: 15px auto; width: 90%;">
        <label for="musicSelect">Wähle Musik:</label>
        <select id="musicSelect" onchange="playMusic()" style="padding: 10px; font-size: 18px;">
            <option value="">Keine Musik</option>
            <option value="jazz_eins.mp3">Jazz</option>
            <option value="soft_rock_eins.mp3">Rock</option>
            <option value="dance_eins.mp3">Dance</option>
        </select>
    </div>

    <div style="display: flex; justify-content: space-between; width: 90%; margin: 0 auto;">
        <button class="profileButton" onclick="logout()">Abmelden</button>
        <button class="profileButton" onclick="accountDelete()">Account löschen</button>
    </div>
</div>
    <audio id="musicPlayer" loop></audio>

    <!-- Einzelspieler Optionen -->
    <div id="singlePlayer" style="display: none;">
        <img src="ein_spieler_spiel_index_banner.png.PNG" alt="Einzelspieler Banner" style="width: 90%;">
        <p>Spiele Filler im Einzelspielermodus</p>
        <select id="gridSize">
            <option value="11">11x11</option>
            <option value="21">21x21</option>
            <option value="31">31x31</option>
        </select>
        <select id="numMoves">
            <option value="5">5 Züge</option>
            <option value="10">10 Züge</option>
            <option value="15">15 Züge</option>
            <option value="20">20 Züge</option>
            <option value="25">25 Züge</option>
            <option value="30">30 Züge</option>
            <option value="40">40 Züge</option>
            <option value="50">50 Züge</option>
            <option value="unlimited">Unendlich</option>
        </select>
        <select id="numColors">
            <option value="3">3 Farben</option>
            <option value="5">5 Farben</option>
            <option value="7">7 Farben</option>
            <option value="9">9 Farben</option>
        </select>
        <button onclick="startSinglePlayer()">Spiel starten</button>
    </div>

    <!-- Mehrspieler Optionen -->
    <div id="multiPlayer" style="display: none;">
        <img src="zwei_spieler_spiel_index_banner.png.PNG" alt="Mehrspieler Banner" style="width: 90%;">
        <p>Spiele Filler im Mehrspielermodus</p>
        <select id="gridSizeMulti">
            <option value="11">11x11</option>
            <option value="21">21x21</option>
            <option value="31">31x31</option>
        </select>
        <select id="numColorsMulti">
            <option value="3">3 Farben</option>
            <option value="5">5 Farben</option>
            <option value="7">7 Farben</option>
            <option value="9">9 Farben</option>
        </select>
        <button onclick="startMultiPlayer()">Spiel starten</button>
    </div>

    <!-- Herausforderungen -->
    <div id="challenges" style="display: none;">
        <img id="challengeBanner" src="herausforderung_spiel_index_banner.png.PNG" alt="Herausforderungen Banner" style="width: 90%;">
        <p>Spiele Filler mit einzigartigen Herausforderungen</p>
        <div id="levelButtons">
            <div id="btn-l1" class="level" onclick="startChallenge(1)">1</div>
            <div id="btn-l2" class="level" onclick="startChallenge(2)">2</div>
            <div id="btn-l3" class="level" onclick="startChallenge(3)">3</div>
            <div id="btn-l4" class="level" onclick="startChallenge(4)">4</div> 
            <div id="btn-l5" class="level" onclick="startChallenge(5)">5</div>
            <div id="btn-l6" class="level" onclick="startChallenge(6)">6</div>
            <div id="btn-l7" class="level" onclick="startChallenge(7)">7</div>
            <div id="btn-l8" class="level" onclick="startChallenge(8)">8</div>
            <div id="btn-l9" class="level" onclick="startChallenge(9)">9</div>
            <div id="btn-l10" class="level" onclick="startChallenge(10)">10</div>
            <div id="btn-l11" class="level" onclick="startChallenge(11)">11</div>
            <div id="btn-l12" class="level" onclick="startChallenge(12)">12</div>
            <div id="btn-l13" class="level" onclick="startChallenge(13)">13</div>
            <div id="btn-l14" class="level" onclick="startChallenge(14)">14</div>
            <div id="btn-l15" class="level" onclick="startChallenge(15)">15</div>
        </div>
    </div>

    <div id="overlay"></div>
    <div id="resultModal">
        <h2>Spielende</h2>
        <p id="resultMessage"></p>
        <button id="restartGame">OK</button>
    </div>

    <script>
        // Funktionen um die verschiedenen Abschnitte anzuzeigen
        function showSinglePlayer() {
            document.getElementById('singlePlayer').style.display = 'block';
            document.getElementById('multiPlayer').style.display = 'none';
            document.getElementById('challenges').style.display = 'none';
            document.getElementById('profile').style.display = 'none';
        }

        function showMultiPlayer() {
            document.getElementById('singlePlayer').style.display = 'none';
            document.getElementById('multiPlayer').style.display = 'block';
            document.getElementById('challenges').style.display = 'none';
            document.getElementById('profile').style.display = 'none';
        }

        function showChallenges() {
            document.getElementById('singlePlayer').style.display = 'none';
            document.getElementById('multiPlayer').style.display = 'none';
            document.getElementById('challenges').style.display = 'block';
            document.getElementById('profile').style.display = 'none';
            loadLevels(); // Lade die Level, wenn die Herausforderungen angezeigt werden
        }

        // Profil anzeigen und Informationen aus localStorage holen
        function showProfile() {
            const currentUser = localStorage.getItem('currentUsername');
            if (!currentUser) {
                alert('Kein Benutzername gefunden. Bitte melden Sie sich an.');
                return;
            }
            document.getElementById('username').textContent = currentUser;
            document.getElementById('userExp').textContent = localStorage.getItem(`exp_${currentUser}`) || 0;

            document.getElementById('singlePlayer').style.display = 'none';
            document.getElementById('multiPlayer').style.display = 'none';
            document.getElementById('challenges').style.display = 'none';
            document.getElementById('profile').style.display = 'block';
        }
function playMusic() {
    const musicSelect = document.getElementById("musicSelect");
    const musicPlayer = document.getElementById("musicPlayer");
    const selectedSong = musicSelect.value;

    const currentUser = localStorage.getItem('currentUsername'); // Hole den aktuellen Benutzernamen

    if (selectedSong) {
        // Speichere die ausgewählte Musik und den Zeitstempel für den aktuellen Benutzer
        const timestamp = new Date().toISOString(); // Aktueller Zeitstempel im ISO-Format
        localStorage.setItem(`${currentUser}_selectedSong`, selectedSong);
        localStorage.setItem(`${currentUser}_musicTimestamp`, timestamp); // Speichere den Zeitstempel
        musicPlayer.src = selectedSong;
        musicPlayer.play();
    } else {
        musicPlayer.pause();
        musicPlayer.currentTime = 0; // Setze den Track zurück
        localStorage.removeItem(`${currentUser}_selectedSong`); // Entferne die Auswahl für den aktuellen Benutzer
        localStorage.removeItem(`${currentUser}_musicTimestamp`); // Entferne den Zeitstempel für den aktuellen Benutzer
    }
}

        

        function startSinglePlayer() {
            const gridSize = document.getElementById('gridSize').value;
            const numMoves = document.getElementById('numMoves').value;
            const numColors = document.getElementById('numColors').value;
            window.location.href = `ein_spieler_spiel.html?gridSize=${gridSize}&numMoves=${numMoves}&numColors=${numColors}`;
        }

        function startMultiPlayer() {
            const gridSize = document.getElementById('gridSizeMulti').value;
            const numColors = document.getElementById('numColorsMulti').value;
            window.location.href = `zwei_spieler_spiel.html?gridSize=${gridSize}&numColors=${numColors}`;
        }

        // Neue Herausforderungen Level
      const levels = {
    1: { gridSize: 5, numColors: 3, numMoves: 7, points: 10, lvl: 1 },
    2: { gridSize: 5, numColors: 3, numMoves: 9, points: 20, lvl: 2 },
    3: { gridSize: 5, numColors: 3, numMoves: 11, points: 25, lvl: 3 },
    4: { gridSize: 7, numColors: 4, numMoves: 13, points: 35, lvl: 4 },
    5: { gridSize: 7, numColors: 4, numMoves: 15, points: 40, lvl: 5 },
    6: { gridSize: 7, numColors: 4, numMoves: 17, points: 49, lvl: 6 },
    7: { gridSize: 9, numColors: 5, numMoves: 20, points: 60, lvl: 7 },
    8: { gridSize: 9, numColors: 5, numMoves: 23, points: 70, lvl: 8 },
    9: { gridSize: 9, numColors: 5, numMoves: 26, points: 81, lvl: 9 },
    10: { gridSize: 11, numColors: 6, numMoves: 29, points: 90, lvl: 10 },
    11: { gridSize: 11, numColors: 6, numMoves: 32, points: 105, lvl: 11 },
    12: { gridSize: 11, numColors: 6, numMoves: 35, points: 121, lvl: 12 },
    13: { gridSize: 13, numColors: 7, numMoves: 37, points: 130, lvl: 13 },
    14: { gridSize: 13, numColors: 7, numMoves: 40, points: 150, lvl: 14 },
    15: { gridSize: 13, numColors: 7, numMoves: 44, points: 169, lvl: 15 }
};


// Funktion zum Hervorheben und Hinzufügen von Level-Boxen für abgeschlossene Levels
function highlightCompletedLevels() {
    const levelButtonsContainer = document.getElementById('levelButtons');
    const currentUser = localStorage.getItem('currentUsername'); // Aktuellen Benutzer abrufen

    // Überprüfen, ob der Benutzer eingeloggt ist
    if (!currentUser) {
        alert('Kein Benutzername gefunden. Bitte melden Sie sich an.');
        return;
    }

    // Alle Level in `localStorage` durchgehen
    for (let i = 1; i <= 15; i++) { // Da es 15 Level gibt
        const levelKey = `level_${currentUser}_${i}`; // Benutzer-spezifischer Level-Schlüssel
        const levelData = JSON.parse(localStorage.getItem(levelKey));

        let levelBox = document.getElementById(`btn-l${i}`);

        // Falls keine Box für das Level existiert, wird eine neue erstellt
        if (!levelBox) {
            levelBox = document.createElement('div');
            levelBox.id = `btn-l${i}`;
            levelBox.className = 'level';
            levelBox.textContent = i;
            levelBox.onclick = () => startChallenge(i);
            levelButtonsContainer.appendChild(levelBox);
        }

        // Hintergrundfarbe je nach Erfolg auf grün oder orange setzen
        if (levelData && levelData.success === true) {
            levelBox.style.backgroundColor = 'lightgreen';
        } else if (levelData && levelData.success === false) {
            levelBox.style.backgroundColor = 'orange';
        }
    }
}

// Funktion zum Starten eines Levels für den aktuellen Benutzer
function startChallenge(level) {
    const { gridSize, numColors, numMoves, points, lvl } = levels[level];
    const currentUser = localStorage.getItem('currentUsername'); // Aktuellen Benutzer abrufen

    // Überprüfen, ob der Benutzer eingeloggt ist
    if (!currentUser) {
        alert('Bitte melden Sie sich an, um ein Level zu spielen.');
        return;
    }

    const levelKey = `level_${currentUser}_${lvl}`; // Benutzer-spezifischer Level-Schlüssel

    // Level-Daten abrufen und Erfolg überprüfen
    let levelData = JSON.parse(localStorage.getItem(levelKey));
    if (levelData === null || levelData.success === false) {
        localStorage.setItem(levelKey, JSON.stringify({ success: false }));
        window.location.href = `herausforderung_spiel.html?gridSize=${gridSize}&numColors=${numColors}&numMoves=${numMoves}&points=${points}&lvl=${lvl}`;
    }
}

        // Abmelden und zur Startseite weiterleiten
        function logout() {
            alert('Erfolgreich abgemeldet!');
            window.location.href = 'index.html';
        }

function accountDelete() {
    const userConfirmed = confirm('Möchtest du wirklich unwiderruflich deinen gesamten Account löschen?');
    if (userConfirmed) {
        const currentUser = localStorage.getItem('currentUsername');

        if (currentUser) {
            // Alle Schlüssel in localStorage durchgehen
            for (let key in localStorage) {
                // Schlüssel, die mit dem Benutzernamen beginnen oder spezifische Level-Informationen sind
                if (key.startsWith(currentUser) || key.startsWith("level_") || key.startsWith("exp_")) {
                    localStorage.removeItem(key); // Benutzer- und Level-Informationen entfernen
                }
            }

            // Den Benutzernamen selbst entfernen
            localStorage.removeItem('currentUsername');
        }

        // Benutzer informieren und zur Startseite zurückkehren
        alert('Dein Account wurde gelöscht.');
        window.location.href = 'index.html';
    } else {
        // Nichts tun, wenn der Benutzer "Abbrechen" wählt
    }
}



// Beim Laden der Seite die abgeschlossenen und gespeicherten Level markieren
window.onload = function() {
    highlightCompletedLevels();
};
    </script>
</body>
</html>
